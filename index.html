å»ºç«‹visualization_history.html,å¯è§†åŒ–æ˜¾ç¤ºå†å²æ•°æ®
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ä¼ æ„Ÿå™¨æ•°æ®å¯è§†åŒ–</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 1000px; margin: auto; }
        .controls { margin: 20px 0; display: flex; gap: 10px; }
        select, button { padding: 8px 16px; font-size: 16px; }
        .chart-box { margin: 30px 0; }
        canvas { max-width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>ğŸ“Š ç‰©è”ç½‘ä¼ æ„Ÿå™¨æ•°æ®å¯è§†åŒ–</h1>
    
    <div class="controls">
        <select id="deviceSelect">
            <option value="all">æ‰€æœ‰è®¾å¤‡</option>
        </select>
        
        <select id="sensorSelect">
            <option value="all">æ‰€æœ‰ç±»å‹</option>
            <option value="temperature">æ¸©åº¦</option>
            <option value="humidity">æ¹¿åº¦</option>
            <option value="pressure">å‹åŠ›</option>
        </select>
        
        <button onclick="loadData()">åŠ è½½æ•°æ®</button>
        <button onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
    </div>
    
    <div class="chart-box">
        <h2>æ•°æ®è¶‹åŠ¿å›¾</h2>
        <canvas id="myChart"></canvas>
    </div>
    
    <h2>æ•°æ®è¡¨æ ¼</h2>
    <table id="dataTable">
        <thead>
            <tr><th>ID</th><th>è®¾å¤‡</th><th>ç±»å‹</th><th>æ•°å€¼</th><th>æ—¶é—´</th></tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
    
    <div style="margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 5px;">
        <h3>ğŸ“ å®éªŒè¯´æ˜</h3>
        <p>1. é¦–å…ˆè¿è¡Œ database.py ç”Ÿæˆæ•°æ®åº“å’ŒJSONæ•°æ®æ–‡ä»¶</p>
        <p>2. ç„¶åæ‰“å¼€æ­¤HTMLæ–‡ä»¶æŸ¥çœ‹å¯è§†åŒ–æ•ˆæœ</p>
        <p>3. ç‚¹å‡»"åŠ è½½æ•°æ®"æŒ‰é’®æ˜¾ç¤ºå›¾è¡¨å’Œæ•°æ®è¡¨æ ¼</p>
    </div>

    <script>
        let chart = null;
        let sensorData = [];
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            const ctx = document.getElementById('myChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ä¼ æ„Ÿå™¨æ•°æ®',
                        data: [],
                        borderColor: 'blue',
                        backgroundColor: 'rgba(0, 0, 255, 0.1)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });
        }
        
        // åŠ è½½JSONæ•°æ®
        async function loadData() {
            try {
                // ä»JSONæ–‡ä»¶åŠ è½½æ•°æ®
                const response = await fetch('sensor_data.json');
                sensorData = await response.json();
                
                console.log('åŠ è½½åˆ°æ•°æ®:', sensorData);
                updateUI();
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                alert('è¯·å…ˆè¿è¡Œ database.py ç”Ÿæˆæ•°æ®æ–‡ä»¶ï¼');
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                useMockData();
            }
        }
        
        // æ›´æ–°ç•Œé¢
        function updateUI() {
            const deviceSelect = document.getElementById('deviceSelect');
            const sensorSelect = document.getElementById('sensorSelect');
            const selectedDevice = deviceSelect.value;
            const selectedSensor = sensorSelect.value;
            
            // æ›´æ–°è®¾å¤‡é€‰é¡¹
            const devices = [...new Set(sensorData.map(d => d.device_id))];
            deviceSelect.innerHTML = '<option value="all">æ‰€æœ‰è®¾å¤‡</option>';
            devices.forEach(device => {
                deviceSelect.innerHTML += `<option value="${device}">${device}</option>`;
            });
            deviceSelect.value = selectedDevice;
            
            // ç­›é€‰æ•°æ®
            const filteredData = sensorData.filter(item => {
                const deviceMatch = selectedDevice === 'all' || item.device_id === selectedDevice;
                const sensorMatch = selectedSensor === 'all' || item.sensor_type === selectedSensor;
                return deviceMatch && sensorMatch;
            });
            
            // æ›´æ–°è¡¨æ ¼
            updateTable(filteredData);
            
            // æ›´æ–°å›¾è¡¨ï¼ˆåªæ˜¾ç¤ºæ¸©åº¦æ•°æ®ï¼‰
            const tempData = filteredData.filter(d => d.sensor_type === 'temperature');
            updateChart(tempData);
        }
        
        // æ›´æ–°è¡¨æ ¼
        function updateTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                const row = `<tr>
                    <td>${item.id}</td>
                    <td>${item.device_id}</td>
                    <td>${item.sensor_type}</td>
                    <td>${item.value}</td>
                    <td>${item.timestamp}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateChart(data) {
            chart.data.labels = data.map(d => d.timestamp.substring(11, 16)); // åªæ˜¾ç¤ºæ—¶é—´
            chart.data.datasets[0].data = data.map(d => d.value);
            chart.data.datasets[0].label = 'æ¸©åº¦æ•°æ®';
            chart.update();
        }
        
        // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆå½“JSONæ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼‰
        function useMockData() {
            sensorData = [
                {id: 1, device_id: 'device_001', sensor_type: 'temperature', value: 25.3, timestamp: '2024-01-15 10:00:00'},
                {id: 2, device_id: 'device_001', sensor_type: 'temperature', value: 26.1, timestamp: '2024-01-15 11:00:00'},
                {id: 3, device_id: 'device_001', sensor_type: 'humidity', value: 65.2, timestamp: '2024-01-15 11:30:00'},
                {id: 4, device_id: 'device_002', sensor_type: 'temperature', value: 24.8, timestamp: '2024-01-15 12:00:00'},
            ];
            updateUI();
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            initChart();
            // è‡ªåŠ¨åŠ è½½æ•°æ®
            setTimeout(() => loadData(), 500);
            
            // å½“ä¸‹æ‹‰èœå•å˜åŒ–æ—¶é‡æ–°ç­›é€‰
            document.getElementById('deviceSelect').onchange = updateUI;
            document.getElementById('sensorSelect').onchange = updateUI;
        };
    </script>
</body>
</html>